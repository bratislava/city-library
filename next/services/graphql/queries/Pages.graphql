fragment PageSitemapParent on PageEntity {
  attributes {
    title
    slug
    sitemapParent {
      data {
        attributes {
          title
          slug
          sitemapParent {
            data {
              attributes {
                title
                slug
              }
            }
          }
        }
      }
    }
  }
}


fragment PageEntity on PageEntity {
  id
  attributes {
    slug
    title
    createdAt
    updatedAt
    publishedAt
    listingImage {
      data {
        attributes {
          name
          width
          height
          url
          createdAt
          hash
          mime
          provider
          size
          alternativeText
          updatedAt
        }
      }
    }
    layout
    perex
    pageCategory {
      data {
        ...PageCategoryEntity
      }
    }
    sections {
      ...Sections
    }

    locale
    localizations {
      data {
        ...PageLocalizationEntity
      }
    }
    Seo {
      id
      metaTitle
      metaDescription
      keywords
      metaRobots
      metaViewport
      canonicalURL
    }
    sitemapParent {
      data {
        ...PageSitemapParent
      }
    }
  }
}

fragment SectionLinkPage on PageEntity {
  id
  attributes {
    layout
    title
    slug
    createdAt
    updatedAt
    listingImage {
      data {
        attributes {
          name
          width
          height
          url
          createdAt
          hash
          mime
          provider
          size
          updatedAt
          alternativeText
        }
      }
    }
  }
}

fragment PageWithBaseFieldsEntity on PageEntity {
  id
  attributes {
    title
    slug
    createdAt
    updatedAt
  }
}

fragment PageLocalizationEntity on PageEntity {
  id
  attributes {
    slug
    locale
  }
}

fragment Category on Category {
  title
  priority
  pages(pagination: { limit: 20 }) {
    ...PageLink
  }
  pageLink {
    ...PageLink
  }
  createdAt
  updatedAt
}

fragment PageCategoryEntity on CategoryEntity {
  attributes {
    ...Category

    subCategories {
      data {
        id
        attributes {
          ...Category
        }
      }
    }

    parentCategory {
      data {
        id
        attributes {
          ...Category
          parentCategory {
            data {
              id
              attributes {
                ...Category
              }
            }
          }
        }
      }
    }
  }
}

fragment ParentPage on PageEntity {
  id
  attributes {
    title
    slug
    layout
    pageCategory {
      data {
        ...PageCategoryEntity
      }
    }
  }
}

fragment PromoNewsCard on PageEntity {
  id
  __typename
  attributes {
    title
    slug
  }
}

# strapi returns just the default locale if no locale is provided
# easiest way to get all static paths is to ask for all locales sequentially
query PagesStaticPaths($locale: I18NLocaleCode) {
  pages(locale: $locale) {
    data {
      id
      attributes {
        slug
        locale
      }
    }
  }
}

query PageBySlug($slug: String!, $locale: I18NLocaleCode!) {
  pages(filters: { slug: { eq: $slug } }, locale: $locale) {
    data {
      ...PageEntity
    }
  }
}

query PagesByLayout(
  $layout: String!
  $locale: I18NLocaleCode!
  $start: Int
  $limit: Int
  $sort: String = "publishedAt:desc"
) {
  pages(
    filters: { layout: { eq: $layout } }
    locale: $locale
    pagination: { start: $start, limit: $limit }
    sort: [$sort]
  ) {
    data {
      ...PageEntity
    }
  }
}

query PagesByLayoutPaginated(
  $layout: String!
  $locale: I18NLocaleCode!
  $start: Int
  $limit: Int
  $sort: String = "publishedAt:desc"
) {
  pages(
    filters: { layout: { eq: $layout } }
    locale: $locale
    pagination: { start: $start, limit: $limit }
    sort: [$sort]
  ) {
    data {
      ...PageEntity
    }
    meta {
      pagination {
        ...Pagination
      }
    }
  }
}

query PagesByLayoutCount($layout: String!, $locale: I18NLocaleCode!) {
  pages(filters: { layout: { eq: $layout } }, locale: $locale) {
    meta {
      pagination {
        total
      }
    }
  }
}
